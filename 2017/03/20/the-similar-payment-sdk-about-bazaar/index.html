<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <title>Bazaar支付的服务端验证 | terrancy`s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="由于之前对Bazzar支付方式的了解不够透彻,以至于我以为支付的验证放在客户端便能解决问题了,等到上线之后发现游戏的充值分分钟钟破解才追悔莫及">
<meta property="og:type" content="article">
<meta property="og:title" content="Bazaar支付的服务端验证">
<meta property="og:url" content="http://blog.terrancy.com/2017/03/20/the-similar-payment-sdk-about-bazaar/index.html">
<meta property="og:site_name" content="terrancy`s blog">
<meta property="og:description" content="由于之前对Bazzar支付方式的了解不够透彻,以至于我以为支付的验证放在客户端便能解决问题了,等到上线之后发现游戏的充值分分钟钟破解才追悔莫及">
<meta property="og:updated_time" content="2017-05-30T02:34:40.647Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bazaar支付的服务端验证">
<meta name="twitter:description" content="由于之前对Bazzar支付方式的了解不够透彻,以至于我以为支付的验证放在客户端便能解决问题了,等到上线之后发现游戏的充值分分钟钟破解才追悔莫及">
  
    <link rel="alternative" href="/atom.xml" title="terrancy`s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
      <link href="//cdn.staticfile.org/animate.css/3.4.0/animate.min.css" rel="stylesheet">
  
  
  
      <script src="//cdn.staticfile.org/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.staticfile.org/pace/1.0.2/themes/pink/pace-theme-bounce.css" rel="stylesheet">
  
  
    <script src="//cdn.staticfile.org/offline-js/0.7.14/offline.min.js"></script>
    <link href="//cdn.staticfile.org/offline-js/0.7.14/themes/offline-language-english.css" rel="stylesheet">
    <link href="//cdn.staticfile.org/offline-js/0.7.14/themes/offline-theme-chrome-indicator.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link href="//cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
  <script src="//cdn.staticfile.org/jquery/2.2.1/jquery.min.js"></script>
  <script src="//cdn.staticfile.org/clipboard.js/1.5.5/clipboard.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: false,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false,
          fancybox_js: "//cdn.staticfile.org/fancybox/2.1.5/jquery.fancybox.min.js",
          scrollreveal: "//cdn.jsdelivr.net/scrollreveal.js/3.3.1/scrollreveal.min.js",
          background_image: {dir:"AprilsLie",min_mun:27,max_num:31},
          baidu_share:{on:true},
          comments_changyan:{on:"true",app_id:"cyt2vJE4I",conf:"prod_693e657ec102e31bcd97557015f49ae2"}
      }
  </script>
  <!-- <script src="https://rawgit.com/DIYgod/DPlayer/master/dist/DPlayer.min.js"></script> -->
  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn" alt="avatar">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">terrancy</a></h1>
        </hgroup>

        
        <p class="header-subtitle">放慢了步伐,只为跑得更远~</p>
        
        
        <form action="https://www.google.com/search" target="_blank" method="get" accept-charset="UTF-8">
          <input type="text" name="q" class="search st-default-search-input" autocomplete="off" maxlength="20" placeholder=" 搜索...">
          <input type="hidden" name="q" autocomplete="off" value="site:blog.terrancy.com">
        </form>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>

                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:terrancy@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/terrancy" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/terrancy" title="GitHub"></a>
                            
                                <a class="fa V2EX" target="_blank" href="http://v2ex.com/member/terrancy" title="V2EX"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>

                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QQ/">QQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Steam/">Steam</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/U8/">U8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VideoJS/">VideoJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/analysis/">analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bigdata/">bigdata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/burg/">burg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cdn/">cdn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud-storage/">cloud storage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/composer/">composer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crawler/">crawler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/danmaku/">danmaku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deep-learning/">deep-learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/duoshuo/">duoshuo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/email/">email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encrypt/">encrypt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exception/">exception</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facebook/">facebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/framework/">framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/">ftp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gifthub/">gifthub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/images/">images</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jotting/">jotting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lamp/">lamp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/live/">live</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/marathon/">marathon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pay/">pay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/payment/">payment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pjax/">pjax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plugin/">plugin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/problem/">problem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/push/">push</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyhton/">pyhton</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytorch/">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sport/">sport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/staticFile/">staticFile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tencent/">tencent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial/">tutorial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/twitch/">twitch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virus/">virus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wechat/">wechat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/youtube/">youtube</a></li></ul>
                    </div>
                </section>
                

                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://chloy.com/">山上淘金</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.rogerblog.cn/">Roger</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://lintingbin2009.github.io/">Darcy</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">terrancy</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn" alt="avatar">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">terrancy</a></h1>
            </hgroup>
            
            <p class="header-subtitle">放慢了步伐,只为跑得更远~</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:terrancy@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/terrancy" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/terrancy" title="GitHub"></a>
                            
                                <a class="fa V2EX" target="_blank" href="http://v2ex.com/member/terrancy" title="V2EX"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>

      <div class="body-wrap" id="article-list"><article id="post-the-similar-payment-sdk-about-bazaar" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/20/the-similar-payment-sdk-about-bazaar/" class="article-date">
      <time datetime="2017-03-20T15:29:54.000Z" itemprop="datePublished">2017-03-20</time>
</a>
      
  <a href="/2017/03/20/the-similar-payment-sdk-about-bazaar/#comments" title="查看评论">
      <i class="fa fa-comments-o" aria-hidden="true"></i>
      <span id = "sourceId::http://blog.terrancy.com/2017/03/20/the-similar-payment-sdk-about-bazaar/" class = "cy_cmt_count"></span>条评论
      <script id="cy_cmt_num" src="http://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyt2vJE4I"></script>
  </a>


    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Bazaar支付的服务端验证
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/pay/">pay</a><a class="article-category-link" href="/categories/pay/Bazzar/">Bazzar</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pay/">pay</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="游戏上线后充值被破解"><a href="#游戏上线后充值被破解" class="headerlink" title="游戏上线后充值被破解"></a>游戏上线后充值被破解</h2><p>由于之前对Bazzar支付方式的了解不够透彻,以至于我以为支付的验证放在客户端便能解决问题,等到上线之后发现游戏的充值分分钟钟被lucky pacher破解,真是后悔莫及.因为对于服务端而言,现有的参数远远不能做任何验证的.无奈,只能在新包中重新对好API后等待游戏包强制更新了.</p>
<h2 id="游戏服务端API验证功能"><a href="#游戏服务端API验证功能" class="headerlink" title="游戏服务端API验证功能"></a>游戏服务端API验证功能</h2><p>Cafebazaar Developer API is a REST API that allows you to automatically perform some of your product management tasks. Using this API, you can check the status of your products and subscriptions sales from your personal server.</p>
<h3 id="Bazaar充值验证的OAuth2授权"><a href="#Bazaar充值验证的OAuth2授权" class="headerlink" title="Bazaar充值验证的OAuth2授权"></a>Bazaar充值验证的OAuth2授权</h3><p>因为Bazzar的充值验证功能是需要经过OAuth2授权之后才能请求的,所以在此之前需要预先通过授权获取refresh_token 和 access_token并保存在指定地方.一旦access_token失效之后需要通过refresh_token重新获取,并重新保存.当然,前提是你必须要现在开发者后台先创建好client_id和client_secret以及redirect_uri.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAccessToken</span><span class="params">()</span></span>&#123;</div><div class="line">    $jsonAccess = file_get_contents(<span class="keyword">$this</span>-&gt;dirConfig.<span class="string">"/access.json"</span>);</div><div class="line">    $arrDataAccess = json_decode($jsonAccess,<span class="keyword">true</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($arrDataAccess[<span class="string">'dateline'</span>]) &amp;&amp; <span class="keyword">$this</span>-&gt;getAccessTokenExpire($arrDataAccess[<span class="string">'dateline'</span>]))&#123;</div><div class="line">        $arrGetAccessTokenWhere = <span class="keyword">array</span>(</div><div class="line">            <span class="string">"grant_type"</span>        =&gt;      <span class="string">"refresh_token"</span>,</div><div class="line">            <span class="string">"client_id"</span>        =&gt;      <span class="keyword">$this</span>-&gt;idClient,</div><div class="line">            <span class="string">"client_secret"</span>        =&gt;      <span class="keyword">$this</span>-&gt;secretClient,</div><div class="line">            <span class="string">"refresh_token"</span>        =&gt;      <span class="keyword">$this</span>-&gt;tokenRefresh,</div><div class="line">        );</div><div class="line"></div><div class="line">        $jsonAccess = <span class="keyword">$this</span>-&gt;apiCurl-&gt;curlByPost(json_encode(<span class="keyword">$this</span>-&gt;uriGetToken),$arrGetAccessTokenWhere);</div><div class="line">        $arrDataAccess = json_decode($jsonAccess,<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($arrDataAccess[<span class="string">'access_token'</span>]))&#123;</div><div class="line">            $arrDataAccess[<span class="string">'dateline'</span>] = <span class="keyword">$this</span>-&gt;getCurrentTimeStamp() + $arrDataAccess[<span class="string">'expires_in'</span>];</div><div class="line">            $jsonAccess = json_encode($arrDataAccess);</div><div class="line">            file_put_contents(<span class="keyword">$this</span>-&gt;dirConfig.<span class="string">"/access.json"</span>,$jsonAccess);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> $arrDataAccess;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Bazaar充值验证API的接入"><a href="#Bazaar充值验证API的接入" class="headerlink" title="Bazaar充值验证API的接入"></a>Bazaar充值验证API的接入</h3><p>获取到Bazzar的授权access_token之后,方可通过purchase validation api 获取相应的数据.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPurchaseValidation</span><span class="params">($arrData)</span></span>&#123;</div><div class="line">    $arrDataAccess  = <span class="keyword">$this</span>-&gt;getAccessToken();</div><div class="line">    $urlPurchaseValidation = <span class="string">"https://pardakht.cafebazaar.ir/devapi/v2/api/validate/&#123;$arrData['packagename']&#125;/inapp/&#123;$arrData['productId']&#125;/purchases/&#123;$arrData['purchaseToken']&#125;?access_token="</span>.$arrDataAccess[<span class="string">'access_token'</span>];</div><div class="line">    $timeLog = @date(<span class="string">'[d/M/Y:H:i:s]'</span>);</div><div class="line">    file_put_contents(<span class="keyword">$this</span>-&gt;dirRoot.<span class="string">"/purchaseValidation.txt"</span>,$timeLog.<span class="string">"-"</span>.$urlPurchaseValidation.PHP_EOL,FILE_APPEND);</div><div class="line">    $jsonPurchaseValidation = file_get_contents($urlPurchaseValidation);</div><div class="line">    file_put_contents(<span class="keyword">$this</span>-&gt;dirRoot.<span class="string">"/purchaseValidation.txt"</span>,$timeLog.<span class="string">"-"</span>.$jsonPurchaseValidation.PHP_EOL,FILE_APPEND);</div><div class="line">    <span class="keyword">return</span> $jsonPurchaseValidation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果请求成功无误的话,将会从purchase validation api获取到一段json格式的数据,如下所示:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   <span class="attr">"consumptionState"</span>: <span class="number">1</span>,</div><div class="line">   <span class="attr">"purchaseState"</span>: <span class="number">0</span>,</div><div class="line">   <span class="attr">"kind"</span>: <span class="string">"androidpublisher#inappPurchase"</span>,</div><div class="line">   <span class="attr">"developerPayload"</span>: <span class="string">"something"</span>,</div><div class="line">   <span class="attr">"purchaseTime"</span>: <span class="number">1414181378566</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>程序通过上述参数就可以判断该订单是否充值成功.</p>
<p>以下是官方对各个参数的说明.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>consumptionState</td>
<td style="text-align:center">This field is 0, if the purchase is consumed, and 1 otherwise.</td>
</tr>
<tr>
<td>purchaseState</td>
<td style="text-align:center">Normally this field is 0, but if the purchase is refunded it is 1.</td>
</tr>
<tr>
<td>kind</td>
<td style="text-align:center">Type of the returned resource. This will always be androidpublisher#inappPurchase</td>
</tr>
<tr>
<td>developerPayload</td>
<td style="text-align:center">The payload string that is sent to Bazaar by app when making the purchase.</td>
</tr>
<tr>
<td>purchaseTime</td>
<td style="text-align:center">Time of the purchase as milliseconds from EPOCh (1970/1/1).</td>
</tr>
</tbody>
</table>
<h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p>Bazaar充值中也使用到了RSA加密验证确保数据传输的完整性以防止他人的篡改,在Bazaar开发者后台中找到一串经过base64加密过的公钥.当客户端向服务端发起充值请求之后,Bazaar服务器端相应的会返回一系列参数.而这部分校验过程中需要使用到RSA加解密.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>生活难免会有糊涂的时候,这时候的我们更需要拿起自身的勇气和耐心,敢于承担与付出.</li>
<li>Bazaar的充值流程和google play的充值流程是相似的,甚至于他们的验证方式.</li>
<li>此次的经验教训加深了我对OAuth2的权限的了解以及RESTFUL的异同.</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://developers.cafebazaar.ir/en/docs/developer-api-v2-introduction/developer-api-v2-getting-started/" target="_blank" rel="external">In-app-developer-api-oauth2</a><br><a href="http://developers.cafebazaar.ir/en/docs/developer-api-v2-introduction/developer-api-v2-ref-validate/" target="_blank" rel="external">In-app-purchase-validation</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2017/03/20/the-similar-payment-sdk-about-bazaar/">Bazaar支付的服务端验证</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">terrancy</a></p>
        <p><span>发布时间:</span>2017-03-20, 23:29:54</p>
        <p><span>最后更新:</span>2017-05-30, 10:34:40</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2017/03/20/the-similar-payment-sdk-about-bazaar/" title="Bazaar支付的服务端验证">http://blog.terrancy.com/2017/03/20/the-similar-payment-sdk-about-bazaar/</a>
            <span class="copy-path" data-clipboard-text="原文: http://blog.terrancy.com/2017/03/20/the-similar-payment-sdk-about-bazaar/　　作者: terrancy" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2017/03/21/how-to-get-facebook-live/">
                    如何进行Facebook直播
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/03/19/make-a-high-efficiency-and-large-concurrency-game-framework/">
                    高效大并发游戏架构的整理与实施
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#游戏上线后充值被破解"><span class="toc-number">1.</span> <span class="toc-text">游戏上线后充值被破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#游戏服务端API验证功能"><span class="toc-number">2.</span> <span class="toc-text">游戏服务端API验证功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bazaar充值验证的OAuth2授权"><span class="toc-number">2.1.</span> <span class="toc-text">Bazaar充值验证的OAuth2授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bazaar充值验证API的接入"><span class="toc-number">2.2.</span> <span class="toc-text">Bazaar充值验证API的接入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#补充说明"><span class="toc-number">3.</span> <span class="toc-text">补充说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>





    
<div class="share">
    
        <div class="bdsharebuttonbox" data-tag="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <!-- <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a> -->
        </div>
        <script>
            var baiduSharePic = $('body').css('background').replace(/.*url\(\"([^\)]+)\"\).*/gi,'$1') || "";
            window._bd_share_config={
                "common":{
                  "bdSnsKey":{},
                  "bdText":"Bazaar支付的服务端验证　| terrancy`s blog",
                  "bdMini":"2",
                  "bdMiniList":false,
                  "bdPic": baiduSharePic,
                  "bdStyle":"0",
                  "bdSize":"24"
                },
                "share":{}
              };
              var scriptBaiduShare;
              scriptBaiduShare = document.createElement('script');
              scriptBaiduShare.src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5);
              scriptBaiduShare.id = 'id_bgimg_baidu_share';
              if($('#id_bgimg_baidu_share').length) $('#id_bgimg_baidu_share').remove();
              window._bd_share_main = false;
              with(document)0[(getElementsByTagName('head')[0]||body).appendChild(scriptBaiduShare)];

        </script>
    

    


</div>




    
        
<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="http://blog.terrancy.com/2017/03/20/the-similar-payment-sdk-about-bazaar/" class="cy_thread"></div>
<script type="text/javascript">
(function(){
var appid = 'cyt2vJE4I';
var conf = 'prod_693e657ec102e31bcd97557015f49ae2';
 var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); })(); </script>

    
        <div id="gitalk-container">1111111111111</div>
<link rel='stylesheet' href="https://unpkg.com/gitalk/dist/gitalk.css">
<style type="text/css">
/*多说附加样式*/

#gitalk-container .gt-avatar {
  background: none !important;
  box-shadow: none !important;
}

#gitalk-container .gt-avatar img, #ds-thread #gitalk-container ul.ds-children .gt-avatar img {
  width: 50px !important;
  height: 50px !important;
  -webkit-transition: .8s;
  -moz-transition: .8s;
  -o-transition: .8s;
  -ms-transition: .8s;
  padding: 1px;
  border: 1px solid #ddd;
  background: #fff;
}

.ds-post:hover .gt-avatar img {
  transform: rotate(720deg);
  -webkit-transform: rotate(720deg);
  -moz-transform: rotate(720deg);
  -o-transform: rotate(720deg);
  -ms-transform: rotate(720deg);
  border-radius: 30px !important;
}

#gitalk-container .gt-avatar img:hover {
  transform: rotate(720deg);
  -webkit-transform: rotate(720deg);
  -moz-transform: rotate(720deg);
  -o-transform: rotate(720deg);
  -ms-transform: rotate(720deg);
  border-radius: 30px !important;
}

#ds-thread #gitalk-container .ds-comment-body, #ds-thread #gitalk-container ul.ds-children .ds-comment-body {
  padding-left: 70px !important;
}

#ds-thread #gitalk-container .ds-comment-body, #ds-thread #gitalk-container ul.ds-children .ds-comment-body {
  padding-left: 70px !important;
}

.ds-post:hover {
  background: #eee !important;
}

#ds-thread #gitalk-container ul.ds-children .gt-avatar {
  width: 50px !important;
}

#ds-thread #gitalk-container .ds-replybox {
  padding: 0 0 0 80px !important;
}

#gitalk-container #ds-ctx .ds-ctx-entry .ds-ctx-body {
  margin-left: 68px !important;
}

#ds-recent-comments li.ds-comment:nth-of-type(1) {
  border: none !important;
}

/*多说附加样式结束*/

/** 多说最近留言样式 **/

#ds-recent-comments .gt-avatar img {
  width: 54px;
  height: 54px;
  /*设置图像的长和宽，这里要根据自己的评论框情况更改*/
  border-radius: 27px;
  /*设置图像圆角效果,在这里我直接设置了超过width/2的像素，即为圆形了*/
  -webkit-border-radius: 27px;
  /*圆角效果：兼容webkit浏览器*/
  -moz-border-radius: 27px;
  box-shadow: inset 0 -1px 0 #3333sf;
  /*设置图像阴影效果*/
  -webkit-box-shadow: inset 0 -1px 0 #3333sf;
  -webkit-transition: 0.4s;
  -webkit-transition: -webkit-transform 0.4s ease-out;
  transition: transform 0.4s ease-out;
  /*变化时间设置为0.4秒(变化动作即为下面的图像旋转360读）*/
  -moz-transition: -moz-transform 0.4s ease-out;
}

#ds-recent-comments .gt-avatar img:hover {
  /*设置鼠标悬浮在头像时的CSS样式*/
  box-shadow: 0 0 10px #fff;
  rgba(255, 255, 255, .6), inset 0 0 20px rgba(255, 255, 255, 1);
  -webkit-box-shadow: 0 0 10px #fff;
  rgba(255, 255, 255, .6), inset 0 0 20px rgba(255, 255, 255, 1);
  transform: rotateZ(360deg);
  /*图像旋转360度*/
  -webkit-transform: rotateZ(360deg);
  -moz-transform: rotateZ(360deg);
}

/** 扑街 **/

#gitalk-container .gt-header-comment textarea {
  background: url(http://blog.terrancy.com/resources/duoshuo/pujie.png) right no-repeat;
}
</style>
<script src="https://unpkg.com/gitalk@1.2.2/dist/gitalk.min.js"></script>
<script src="https://cdn.staticfile.org/blueimp-md5/2.7.0/js/md5.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
      clientID:  '1875216265d16240a6f3',
      clientSecret: 'd03e77a0113a072a376c6285fdf13cfa2978cf56',
      id: md5(location.pathname),
      repo: 'terrancy.github.io',
      owner: 'terrancy',
      admin: 'terrancy',
      distractionFreeMode: true,
    })
    gitalk.render('gitalk-container')
</script>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2017/03/21/how-to-get-facebook-live/" title="上一篇: 如何进行Facebook直播">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/03/19/make-a-high-efficiency-and-large-concurrency-game-framework/" title="下一篇: 高效大并发游戏架构的整理与实施">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/19/the-exprience-about-qiiu-cloud-sdk-integration/">话说七牛云</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/the-integration-of-the-common-abroad-payment-sdk/">关于海外支付SDK的集成方案与总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/30/the-tutorial-about-microclient-with-Steam/">Steam-SDK 接入教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/the-basical-tutorial-about-the-git/">Git基础教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/15/the-tutorial-about-wechat-mini-program/">微信小程序基础教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/the-tutorial-about-the-U8-server/">U8-服务端环境搭建及其思想架构的总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/31/the-tutorial-about-microclient-with-tencent/">关于接入QQ微端游戏的教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/how-to-set-up-ftp-server-on-the-centos/">在Centos7环境下开发环境打搭建杂集</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/the-elegant-framework-about-pytorch/">深度学习-Pytorch框架初体验</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/27/the-web-plugin-with-google-customer-search/">博客站内搜索引擎</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/26/the-comment-system-about-duoshuo/">多说评论系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/the-web-plugin-with-music-player/">多功能网页音乐播放器</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/15/the-way-about-AntiWannaCry/">WannaCry蠕虫病毒的快速蔓延与预防</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/30/the-awesome-automated-operations-tool-ELK/">自动化运营维护人员的自动化运维工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/the-common-prolems-about-PHP/">PHP的常见问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/25/how-to-get-network-with-ipv6/">如何配置IPV6环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/21/how-to-get-facebook-live/">如何进行Facebook直播</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/the-similar-payment-sdk-about-bazaar/">Bazaar支付的服务端验证</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/19/make-a-high-efficiency-and-large-concurrency-game-framework/">高效大并发游戏架构的整理与实施</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/19/some-conclusion-about-analysis-of-big-data/">关于大数据量的分析整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/19/the-api-server-was-under-DDOS-attacks/">游戏API服务器正面临着DDOS攻击</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/the-method-to-get-start-crawler-with-python/">入门级爬虫的基本姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/how-to-get-simulation-login-zhihu-with-python/">如何使用python模拟登入知乎</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/the-difference-between-http-and-text/">通过Http获取和通过流的形式下载文件的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/08/research-about-phpunit-tool/">自动化测试工具PHPUNIT实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/02/research-about-api-live-sdk-with-youtube/">youtube直播sdk嵌入的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/18/how-to-use-package-manage-tool-for-php/">如何合理对待PHP包管理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/life-can't-live-for-bread-or-mike-without-the-dream/">生活不止眼前的苟且,还有诗和远方</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/the-free-ssl-certificate-let-s-encrpt/">免费的SSL证书Let's Encrypt的安装与使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/the-beautiful-system-boot-tool-with-burg/">使用burg为多系统点亮酷炫的开机启动效果</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/restful-api-with-flask/">基于flask的RESTful-API应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/08/idea-about-position-of-the-content-tag-with-the-mouse-movement/">目录跟随鼠标移动定位</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/26/live-to-run-run-to-life/">跑步,与生俱来</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/23/research-about-api-live-sdk-with-twitch/">国外的直播SDK-Twitch的接入与应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/22/the-document-about-vietnam-payment/">越南支付的接入总结文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/application-to-send-push-notifications-using-Google-Cloud-Messaging/">关于谷歌云推送的应用实例</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/docker-image-about-gitlab/">在docker环境下关于gitlab的镜像部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/docker-image-about-lamp-distributed/">在docker环境下关于分布式LAMP方案的镜像部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/04/a-tutorial-about-docker/">玩转docker镜像</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/29/resource-about-static-file-cdn-for-free/">关于常用优秀开源库免费CDN的整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/how-to-switch-web-pages-without-refresh/">如何实现页面之间的切换不刷新</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/26/how-to-make-blog-became-a-multifunctional-system-with-plugin/">如何让自己的部落格变成功能性更强的系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/24/how-to-resolve-the-common-problems-about-git-that-occurred-as-usual/">关于在日常生活中经常发生的git问题的梳理与总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/22/how-to-resolve-mx-records-exception/">腾讯企业邮箱域名MX记录设置异常</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/research-about-encryption-with-different-pay-sdk/">浅谈支付加密及签名验证</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/research-about-using-live-from-alibaba/">浅谈九游直播接入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/research-about-using-sdk-pay-from-different-channel/">浅谈支付SDK的接入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/21/how-to-use-plugin-DPlayer/">html5视频播放器DPlayer</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/18/how-to-use-javascript-about-videoJs/">html5视频播放器VideoJS</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/11/how-to-bulid-blog-with-hexo/">HEXO+Github,搭建属于自己的博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/11/fortress-besieged-personal/">围城</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/10/how-to-surfing-the-internet-all-over-the-world/">如何科学上网</a></li></ul>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
              
                  
                      <span id="busuanzi_container_site_pv" style='display:none'>
                          <span id="site-visit" >本站到访数:
                              <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span>
                          </span>
                      </span>
                  
                  
                      <span>, </span>
                  
                  
                      <span id="busuanzi_container_page_pv" style='display:none'>
                          <span id="page-visit">本页阅读量:
                              <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
                          </span>
                      </span>
                  
              
            </div>
            <div class="footer-right">
                <!--
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
                -->
                <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
            </div>
        </div>
        <div class="visit">
            <i class="fa fa-copyright"></i>
            2016-2018 terrancy
            
                    | <span style="display:inline"><a href="http://www.miitbeian.gov.cn/" target="_blank">闽ICP备16023392号-1</a></span>
            
        </div>
    </div>
</footer>

    </div>
    





    <script src="/js/tpwidget.js"></script>
    <script>
    tpwidget("init", {
        "flavor": "bubble",
        "location": "WS7GQBRNR6V8",
        "geolocation": "enabled",
        "position": "bottom-right",
        "margin": "60px 10px",
        "language": "auto",
        "unit": "c",
        "theme": "chameleon",
        "uid": "UF0695F19E",
        "hash": "4a4afd8e2667df8de77c99b6a4124463"
    });
    tpwidget("show");
    </script>



  
    <script>
    auto= "close";
    random= "open";
    name= "菜鸟播放器";
    geci= "open";
    user= "50469052";
    welcome= "open";
    tips= "欢迎访问菜鸟部落格";
    </script>
    <script type="text/javascript" src="//www.terrancy.com/music/js/netease.js"></script>
  



    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.staticfile.org/require.js/2.1.22/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnumMax = 31;
                var backgroundnumMin = 27;
                var backgroundimg = "url(/background/AprilsLie/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * (backgroundnumMax-backgroundnumMin) + backgroundnumMin));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84318260-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>


<script async="async" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" id="id_busuanzi"></script>

</script>

    <script src="//cdn.staticfile.org/jquery.pjax/1.9.6/jquery.pjax.min.js"></script>


    <script type="text/javascript" color="0,0,255" opacity='0.3' zIndex="-2 " count="30" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>

<script src="/js/tocListen.js"></script>

  </div>
</body>
</html>
